@{
    ViewData["Title"] = "Blog List";
}

<h1></h1>

<h1>Blog List</h1>
<a href="/BlogAjax/create" class="btn btn-success mb-3">New Blog</a>

<table class="table table-striped">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Author</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="blogTableBody"></tbody>
</table>

@section scripts
{
    <script>
        $(document).ready(function () {
            loadBlogs();
        });
        
        function loadBlogs() {
            $.ajax({
                url: "/BlogAjax/List",
                method: "GET",
                success: (response) => {
                    console.log(response);
                    let tableRows = '';
                    response.forEach(item => {
                        tableRows += `
                            <tr id="blog-row-${item.blogId}">
                                <td>${item.blogId}</td>
                                <td>${item.blogTitle}</td>
                                <td>${item.blogAuthor}</td>
                                <td>
                                    <a href="/BlogAjax/editPage/${item.blogId}" class="btn btn-warning btn-sm">Edit</a>
                                    <button type="button" class="btn btn-danger btn-sm" onclick="deleteBlog(${item.blogId})">Delete</button>
                                </td>
                            </tr>
                        `
                    });
                    $('#blogTableBody').html(tableRows);
                },
                error: (xhr) => {
                    console.error(xhr.responseText);
                }
            });
        }
        
        function deleteBlog(id) {
            if (!confirm("Are you sure you want to delete this blog?")) {
                return;
            }
            
            $.ajax({
                url: `/BlogAjax/Delete/${id}`,
                method: "POST",
                success: (response) => {
                    alert(response.message);
                    if (response.isSuccess) {
                        loadBlogs();
                    }
                },
                error: (xhr) => {
                    console.error(xhr.responseText);
                }
            })
        }
    </script>
}
